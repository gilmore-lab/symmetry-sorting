---
title: "Analyzing differences in n-sets"
author: "Rick Gilmore"
date: "`r Sys.time()`"
output: 
  html_document:
    code_folding: hide
    toc: yes
    toc_depth: 3
    toc_float: no
---

# Purpose

This document summarizes analyses and visualizations of differences in the number of sets participants sorted exemplars from the different wallpaper groups.

# Set-up

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  fig.path = "img/",
  dev = "pdf",
  dpi = 300,
  fig.align = "center",
  fig.width = 7,
  fig.height = 5
)

library(tidyverse)
library(lmerTest)
```

# Analysis plan

1. Did the wallpaper groups differ in terms of the *number of sets* into which exemplars were sorted? For example, Vedak et al., 2015 suggested that P1 exemplars were sorted into fewer sets.

# Import data

The N sets data are found in `analysis/data/nsets.csv`.

```{r}
nsets <- readr::read_csv("analysis/data/nsets.csv")
```

There are $n=$ `r length(unique(nsets$Participant))` individual participants.

# Visualizations

We calculate the number of sets per participant and wallpaper group.

```{r}
nsets_participant_df <- nsets %>%
  dplyr::group_by(., Participant, Group) %>%
  dplyr::summarise(., nsets_per = n())
```
```{r, nsets-dotplot}
nsets_participant_plot <- nsets_participant_df %>%
  ggplot(.) +
  aes(x = nsets_per, fill = Group) +
  geom_dotplot(method="histodot",
               binwidth = 1.5,
               show.legend = FALSE) +
  facet_grid(. ~ Group) +
  xlab("N sets") +
  scale_y_continuous(NULL, breaks = NULL)
nsets_participant_plot
```

```{r, nsets-boxplot}
nsets_participant_plot <- nsets_participant_df %>%
  ggplot(.) +
  aes(x = nsets_per, fill = Group) +
  geom_boxplot() +
  facet_grid(Group ~ .) +
  xlab("N sets") +
  scale_y_continuous(NULL, breaks = NULL)
nsets_participant_plot
```

# Analyses

## N sets

Are there differences among the wallpaper groups in terms of the average sizes of the sets?

### Using `afex::aov_car`

```{r}
n_sets_afex <- afex::aov_car(nsets_per ~ Group + Error(Participant/Group), data = nsets_participant_df)
summary(n_sets_afex)
```

P1 exemplars were sorted into larger sets than other wallpaper groups.

```{r, nsets-by-sub-plot-aov}
afex::afex_plot(n_sets_afex, x = "Group", y = "nsets_per")
```

Participants sorted P1 exemplars into a smaller number of categories than the other wallpaper groups.

### Using `lmer`

```{r}
n_sets_lme <- lmer(nsets_per ~ Group + (1 | Participant), data = nsets_participant_df)
summary(n_sets_lme)
```

```{r}
(aov_vals <- anova(n_sets_lme))
```

Compare individual means.

```{r}
(em_n_sets <- emmeans::emmeans(n_sets_lme, "Group"))
summary(pairs(em_n_sets, simple = "Group", adjust = "none"))
```

The 95% CIs for all of the group means overlap; pairwise tests show that P1 < \{P31M, P3M1, P6, P6M\}, but no other means differ.

### Tabular summary with effect sizes

```{r}
n_sets_stats_df <- as_tibble(pairs(em_n_sets, simple = "Group", adjust = "tukey"))
n_sets_stats_df <- n_sets_stats_df %>%
  dplyr::select(., contrast, estimate, t.ratio, df, p.value) %>%
  dplyr::rename(., mean_diff = estimate)

n_sets_es_df <- as_tibble(emmeans::eff_size(em_n_sets, sigma = sigma(n_sets_lme), edf =df.residual(n_sets_lme)))

n_sets_stats_merged_df <- dplyr::full_join(n_sets_stats_df, n_sets_es_df, by=c("contrast")) 

n_sets_stats_merged_df %>%
  dplyr::select(., contrast, t.ratio, p.value, df.x, effect.size) %>%
  knitr::kable(., format = 'html') %>%
  kableExtra::kable_material()
```

